<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Cardeasy - Login</title>
</head>
<body id="body">
<div id="login">
  <label for="email">Email: </label><input id="email" type="text"> <br>
  <label for="password">Senha: </label><input id="password" type="text"> <br>
  <button id="submit" type="button" onclick="submitForm()">Login</button>
</div>
<script src="js/script.js"></script>
<script>
  function UserLogin(email,password) {
    this.email = email
    this.password = password
  }

  function submitForm() {
    const email = document.getElementById("email").value
    const passwd = document.getElementById("password").value
    let js = JSON.stringify(new UserLogin(email,passwd))
    loginRequest(js)
  }

  async function loginRequest(user) {
    let cookiename='token';
    fetch('http://localhost:8080/users/login', {
      method: 'POST',
      headers: {
        'Content-Type':'application/json'
      },
      body: user,
      connection: "keep-alive"
    }).then(response => response.json()).then(data => {
      console.log('POST Request Data:', data);
      setCookie(cookiename,data.token)
    })
            .catch(error => {
              console.error('Error:', error);
            });
  }
  /*//move essas depois pra o script.js//*/
  function setCookie(cname, cvalue) {
    let now = new Date(Date.now())
    now.setDate(now.getDate()+3)
    document.cookie = cname + "=" + cvalue + ";expires=" + now.toUTCString();
  }

  function getCookie(cname) {
    let name = cname + "=";
    let decodedCookie = decodeURIComponent(document.cookie);
    let ca = decodedCookie.split(';');
    for(let i = 0; i <ca.length; i++) {
      let c = ca[i];
      while (c.charAt(0) === ' ') {
        c = c.substring(1);
      }
      if (c.indexOf(name) === 0) {
        return c.substring(name.length, c.length);
      }
    }
    console.log("CAIU!")
    return "";
  }
</script>
</body>

</html>